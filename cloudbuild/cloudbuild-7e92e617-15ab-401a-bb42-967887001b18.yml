steps:
  - name: gcr.io/cloud-builders/docker
    args:
      - build
      - --build-arg
      - TAG_NAME=$SHORT_SHA
      - -t
      - gcr.io/$PROJECT_ID/$REPO_NAME:$SHORT_SHA
      - -f
      - Dockerfile
      - .
  - name: gcr.io/cloud-builders/curl
    entrypoint: curl
    args:
      - --header
      - "x-organization-id: 23f638a9-2769-4632-a7b2-cfbc558d06cf"
      - --header
      - "x-project-id: 036a5e4d-4268-4c38-ad9f-c937376cfb6b"
      - -d
      - '{ "channel": "default",  "update_type": "patch", "container_id":
        a05c72ff-856d-4328-8ca5-8b2552a06270,  "image_name_with_tag":
        "https://gcr.io/projectx-036a5e4d-4268:$SHORT_SHA"}'
      - -X
      - POST
      - https://beta.api.platformer.com/rudder/webhook/v1/container?token=${_PLATFORMER_AUTOGENERATED_CICD}
images:
  - gcr.io/$PROJECT_ID/$REPO_NAME:$SHORT_SHA
